# 検証結果：FMEA/FTAリスクと設計ドキュメントのトレーサビリティ

## 1. 検証方法

- **FMEA・FTAで特定されたリスク/故障モード**ごとに、  
  - ユースケース記述の例外フローや代替フロー
  - ステートマシン図の状態・遷移
  との対応を確認。
- **対応策が設計に盛り込まれていない**、または**内容が不十分/不明確**なものを指摘。
- **トレーサビリティ表**でリスク⇔設計対応の対応状況を明示。

---

## 2. リスク・故障モードごとの対応状況

### 2.1 釣銭機関連

| リスク/故障モード | FMEA/FTA出典 | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 釣銭切れ/排出不良 | FMEA, FTA | 釣銭不足時の購入不可・エラー通知、返金不能時の案内 | UC2 EF-2-1/2, UC4 EF-1-1/2/3 | 「釣銭_返金処理中」,「故障中」 | **対応あり** |
| 釣銭機センサー故障 | FTA | 釣銭残量監視、エラー通知 | UC10 BF-3, UC6 BF-2, UC9 | 「販売停止中」遷移 | **対応あり** |
| 釣銭補充忘れ | FTA | 釣銭補充業務 | UC6 | 管理モード「釣銭補充」 | **対応あり** |
| 釣銭詰まり | FTA | 釣銭払い出し障害時のエラー通知・案内 | UC4 EF-1-1/2/3 | 故障中「投入金返却」 | **対応あり** |

#### 指摘事項
- **返金不能時の利用者救済策（例：管理会社連絡先表示、現場対応）**はUC4 EF-1-2/3で記載されているが、**自動再試行や内部保管処理の詳細**はAF-1-2で簡単に触れられているのみ。**実装詳細や運用フローが不明確**。

---

### 2.2 商品ラック関連

| リスク/故障モード | FMEA/FTA出典 | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 商品詰まり/在庫誤検知 | FMEA, FTA | 商品払い出し不可時のエラー表示・再選択促し | UC2 EF-1-1/2, UC9 | 「商品払い出し」,「故障中」 | **対応あり** |
| 商品ラック在庫センサー故障 | FTA | 在庫センサーで検出、管理者点検 | UC10 BF-3, UC7 | 管理モード「商品補充」 | **対応あり** |
| 商品補充忘れ | FTA | 商品補充業務 | UC7 | 管理モード「商品補充」 | **対応あり** |

#### 指摘事項
- **商品詰まり発生時の利用者救済策（返金/代替商品提供等）**はUC2 EF-1-2で「再選択または取引終了」となっているが、**現金投入済みで商品も受け取れない場合の返金保証や後日対応の詳細が不明確**。

---

### 2.3 投入金口関連

| リスク/故障モード | FMEA/FTA出典 | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 硬貨詰まり/認識不良 | FMEA, FTA | 投入不可時の返却・エラー通知 | UC3 EF-1-1/2, EF-2-1/2 | 「入金受付中」,「故障中」 | **対応あり** |
| 投入金口センサー故障 | FTA | センサー監視、エラー通知 | UC10 BF-3, UC9 | 「販売停止中」遷移 | **対応あり** |
| 金額認識回路故障 | FTA | 金額認識不能時の返金・エラー表示 | UC3 EF-2-1/2 | 「入金受付中」 | **対応あり** |
| 異物投入 | FTA | 投入不可物の返却・通知 | UC3 EF-1-1/2 | 「入金受付中」 | **対応あり** |

#### 指摘事項
- **異物投入や認識不能時の再投入制限や機械保護策**（例：連続異常時の自動停止）は明記されていない。

---

### 2.4 表示パネル関連

| リスク/故障モード | FMEA/FTA出典 | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 表示が出ない/誤表示 | FMEA, FTA | 表示障害時のエラー表示・再取得 | UC1 EF-1-1/2 | 「販売停止中」遷移 | **対応あり** |

#### 指摘事項
- **表示パネル自体が完全に故障し、エラー表示もできない場合の利用者案内や運用フロー**が不明確。

---

### 2.5 商品取り出し口関連

| リスク/故障モード | FMEA | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 商品取り出し不可 | FMEA | 商品払い出し不可時のエラー表示・再選択 | UC2 EF-1-1/2 | 「商品払い出し」 | **対応あり** |

#### 指摘事項
- **商品が払い出されたが取り出し口で詰まった場合の救済策（返金/再払い出し/管理者対応）**が明記されていない。

---

### 2.6 操作パネル関連

| リスク/故障モード | FMEA | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| ボタン反応なし/誤動作 | FMEA | 商品選択不可時のエラー表示・再選択 | UC2 EF-1-1/2 | 「商品選択待ち」 | **対応あり** |

#### 指摘事項
- **操作パネル誤動作時の安全対策（例：誤購入防止、連続誤動作時の自動停止）**が明記されていない。

---

### 2.7 売上金庫関連

| リスク/故障モード | FMEA | 設計上の対応 | 対応ユースケース/フロー | ステートマシン図 | 対応状況 |
|---|---|---|---|---|---|
| 金庫開閉不良/盗難 | FMEA | ロック・開閉ログ、管理者対応 | UC5, UC10, UC9 | 管理モード「売上金回収」 | **対応あり** |

#### 指摘事項
- **盗難発生時のアラート発報や遠隔通報、現場封鎖等の具体的な運用フロー**が不明確。

---

## 3. トレーサビリティ表（まとめ）

| リスク/故障モード | 対応ユースケース/フロー | ステートマシン図 | 対応状況 | 指摘事項 |
|---|---|---|---|---|
| 釣銭切れ/排出不良 | UC2 EF-2, UC4 EF-1 | 釣銭_返金処理中, 故障中 | 対応あり | 返金不能時の運用詳細が不明確 |
| 商品詰まり/在庫誤検知 | UC2 EF-1, UC9 | 商品払い出し, 故障中 | 対応あり | 商品詰まり時の返金保証や後日対応が不明確 |
| 硬貨詰まり/認識不良 | UC3 EF-1, EF-2 | 入金受付中, 故障中 | 対応あり | 異常連続時の自動停止等が不明確 |
| 表示パネル誤表示 | UC1 EF-1 | 販売停止中 | 対応あり | パネル完全故障時の案内が不明確 |
| 商品取り出し不可 | UC2 EF-1 | 商品払い出し | 対応あり | 取り出し口詰まり時の救済策が不明確 |
| 操作パネル誤動作 | UC2 EF-1 | 商品選択待ち | 対応あり | 誤動作時の安全対策が不明確 |
| 金庫開閉不良/盗難 | UC5, UC10, UC9 | 売上金回収 | 対応あり | 盗難時のアラート・封鎖等が不明確 |

---

## 4. 対応が不足・不明確なリスク/故障モード一覧

### 1. 返金不能時の運用詳細
- **該当リスク**：釣銭切れ/排出不良、釣銭詰まり
- **指摘**：返金不能時の自動再試行、内部保管、利用者救済（後日返金等）の運用詳細が不明確

### 2. 商品詰まり時の返金保証や後日対応
- **該当リスク**：商品詰まり/在庫誤検知
- **指摘**：商品が払い出されない場合の現金返金保証や後日対応策が明記されていない

### 3. 異常連続時の自動停止等
- **該当リスク**：硬貨詰まり/認識不良、異物投入
- **指摘**：連続異常時の自動販売停止や管理者自動通報等の安全策が不明確

### 4. 表示パネル完全故障時の案内
- **該当リスク**：表示パネル誤表示/完全故障
- **指摘**：パネル自体が完全に故障し、エラー表示もできない場合の利用者案内や現場運用が不明確

### 5. 商品取り出し口詰まり時の救済策
- **該当リスク**：商品取り出し不可
- **指摘**：商品が取り出し口で詰まった場合の返金や再払い出し、管理者対応の詳細が不明確

### 6. 操作パネル誤動作時の安全対策
- **該当リスク**：操作パネル誤動作
- **指摘**：誤購入防止や連続誤動作時の自動停止等の安全対策が不明確

### 7. 盗難発生時の運用詳細
- **該当リスク**：金庫開閉不良/盗難
- **指摘**：盗難発生時のアラート発報、遠隔通報、現場封鎖等の具体的な運用フローが不明確

---

## 5. まとめ・推奨事項

- **高リスク（RPN高）項目**については、利用者救済や安全・セキュリティ運用の詳細な設計記述が必要です。
- **現状の設計ドキュメントでは、異常発生時の一次対応（エラー通知・再選択・管理者連絡等）は記載されていますが、二次対応（返金保証、後日対応、現場封鎖、再発防止策等）の運用詳細が不足しています。**
- **今後の設計ドキュメントでは、上記不足点を補う具体的な運用フローやシステム仕様の明記を推奨します。**

---

### 参考：トレーサビリティ例

| リスク/故障モード | ユースケースID | フローID | ステート名/遷移名 | 備考 |
|---|---|---|---|---|
| 釣銭切れ | UC2 | EF-2-1/2 | 釣銭_返金処理中 | エラー通知・購入不可表示 |
| 商品詰まり | UC2 | EF-1-1/2 | 商品払い出し | エラー表示・再選択促し |
| 硬貨詰まり | UC3 | EF-1-1/2 | 入金受付中 | 投入不可物返却・通知 |
| 表示誤表示 | UC1 | EF-1-1/2 | 販売停止中 | エラー表示・再取得 |
| 金庫盗難 | UC5 | EF-1-1/2 | 売上金回収 | 警告表示・メンテ依頼 |

---

## 6. 追加で設計に盛り込むべき事項（例）

- 返金不能時の「後日返金受付」や「内部保管金の管理・返還手順」
- 商品詰まり時の「現金返金保証」や「管理者による現場対応フロー」
- 連続異常時の「自動販売停止」「管理者自動通報」
- 表示パネル完全故障時の「現場掲示」「利用者案内」
- 盗難時の「遠隔アラート」「現場封鎖」「警察通報連携」等

---

**ご不明点や追加検証要件があればご指示ください。**