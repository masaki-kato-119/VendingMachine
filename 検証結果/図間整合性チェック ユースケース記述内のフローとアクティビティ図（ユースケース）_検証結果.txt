# ユースケース記述とアクティビティ図の整合性検証結果

---

## UC3 お金を投入する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-3**（システムは現在の投入金額で購入可能な商品ボタンを点灯/選択可に、金額不足の商品ボタンを消灯/選択不可にする。）
  - アクティビティ図では「購入可能な商品ボタンを点灯」はあるが、「金額不足の商品ボタンを消灯/選択不可」の明示的なアクションがない。
  - **指摘**: BF-3 の「金額不足の商品ボタンを消灯/選択不可」部分がアクティビティ図に明示されていない（要素名: 「購入可能な商品ボタンを点灯」直後）。

- **BF-4**（利用者は投入を継続するか（【BF-1】）、商品選択（「商品を選択し購入する」ユースケースへ遷移）を行う。）
  - アクティビティ図では「さらに投入 or 商品選択?」の分岐があるが、「商品選択へ進む」でstopしており、他ユースケースへの遷移が明示されていない。
  - **指摘**: BF-4 の「商品選択（他ユースケースへ遷移）」がアクティビティ図の「商品選択へ進む」要素でstopしており、遷移先が明示されていない。

- **AF-1-3**（処理終了。）
  - アクティビティ図ではキャンセル時にstopしているため、明示的な「処理終了」アクションはないが、実質的に対応しているとみなせる。

- **EF-1-2**（利用者は再度投入するか、取引をキャンセルする（必要に応じてAF-1-1へ）。）
  - アクティビティ図では「再投入または取引をキャンセル」としているが、「AF-1-1へ」の明示的な遷移はない。
  - **指摘**: EF-1-2 の「AF-1-1へ」の遷移がアクティビティ図に明示されていない（要素名: 「再投入または取引をキャンセル」）。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- **「自動販売機の前に立つ」**
  - アクティビティ図の開始直後に「自動販売機の前に立つ」があるが、ユースケース記述には明示的なステップとして存在しない。
  - **指摘**: アクティビティ図要素「自動販売機の前に立つ」はユースケース記述のフローIDに対応しない。

- **「待機状態」**
  - アクティビティ図の「待機状態」もユースケース記述のフローIDには直接対応しない。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **BF-2/BF-3の順序**
  - アクティビティ図では「投入金額・選択可能商品を表示」「購入可能な商品ボタンを点灯」と連続しているが、ユースケース記述では「合計投入金額を表示」と「商品ボタンの点灯/消灯」が明確に分かれている。実装上は同時でもよいが、厳密には2つのアクションが1つにまとめられている。
  - **指摘**: BF-2/BF-3のアクションがアクティビティ図では一体化されている（要素名: 「投入金額・選択可能商品を表示」「購入可能な商品ボタンを点灯」）。

- **例外フローの分岐**
  - アクティビティ図では「金額認識成功?」のNo側で「投入物返却、エラー通知」「再投入または取引をキャンセル」となっているが、ユースケース記述のEF-1-1/EF-1-2の流れ（返却→通知→再投入orキャンセル→AF-1-1へ）が完全には明示されていない。
  - **指摘**: EF-1-2の「AF-1-1へ」の遷移が図で明示されていない。

---

## UC10 機械の状態を確認する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-2**（現地の場合はドアロック解除や点検モードへの切替などの操作を行う。）
  - アクティビティ図には「ドアロック解除」「点検モード切替」等の現地固有操作が明示されていない。
  - **指摘**: BF-2 の「ドアロック解除や点検モードへの切替」アクションがアクティビティ図に存在しない。

- **BF-5**（必要に応じて現場で調整・補充・保守等の後続作業に着手する。）
  - アクティビティ図では「必要に応じて点検・メモ・保守作業へ進む」とあるが、「調整・補充」などの具体的な後続作業への遷移が明示されていない。
  - **指摘**: BF-5 の「調整・補充・保守等の後続作業」への遷移がアクティビティ図に明示されていない。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし（全体的に抽象度が近い）。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **BF-3/BF-4の順序**
  - アクティビティ図では「状態情報を取得→表示→通知→確認→点検・メモ・保守作業」となっており、ユースケース記述の流れと大きな矛盾はない。
  - ただし、「点検票や管理端末に記録する」アクションが図では「点検・メモ」と抽象化されている。

---

## UC9 故障対応を行う

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-7**（再発防止のための対応や消耗部品交換、必要に応じて故障原因・対応内容をシステムへ記録する。）
  - アクティビティ図では「対応・履歴をシステムに記録」アクションがあり、ほぼ対応している。

- **EF-2**（現地での故障対応・小修理によっても復旧不可の場合、機器の交換や運用停止・再訪問手配など中長期対応に切り替える。関連部署へ報告し、現場での安全確認を行う。）
  - アクティビティ図には「現場修理不能」時の分岐があるが、「機器交換や運用停止・再訪問手配」「関連部署へ報告」などの具体的なアクションが明示されていない。
  - **指摘**: EF-2-1, EF-2-2 の「機器交換や運用停止・再訪問手配」「関連部署へ報告」等がアクティビティ図に存在しない。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **BF-4/BF-5/BF-6の順序**
  - アクティビティ図では「修理・部品交換・清掃等を実施→復旧テスト→動作確認→復旧完了通知」となっており、ユースケース記述の流れと整合している。

---

## UC2 商品を選択し購入する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-2**（システムは投入金額（または決済可否）を確認し、選択可能な商品を表示する。）
  - アクティビティ図では「投入金額を表示」「選択可能な商品ボタンを点灯」としているが、「決済可否の確認」が明示されていない。
  - **指摘**: BF-2 の「決済可否の確認」がアクティビティ図に明示されていない。

- **AF-1-3**（処理終了。）
  - アクティビティ図ではキャンセル時にstopしているため、実質的に対応している。

- **EF-1-2, EF-2-2**（利用者は別の商品を選択（【BF-3】へ戻る）または取引終了時はAF-1に進む。）
  - アクティビティ図では「エラー内容を確認し、再選択や投入金返却を検討する」「別の商品（お釣り不要な商品等）を選択」となっているが、「AF-1へ進む」明示的な遷移がない。
  - **指摘**: EF-1-2, EF-2-2 の「AF-1へ進む」遷移がアクティビティ図に明示されていない。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- **「自動販売機の前に立つ」**
  - アクティビティ図の開始直後に「自動販売機の前に立つ」があるが、ユースケース記述には明示的なステップとして存在しない。
  - **指摘**: アクティビティ図要素「自動販売機の前に立つ」はユースケース記述のフローIDに対応しない。

- **「待機状態になる」**
  - アクティビティ図の「待機状態になる」もユースケース記述のフローIDには直接対応しない。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **BF-1/BF-2の順序**
  - アクティビティ図では「お金を投入する→投入金額を表示→選択可能な商品ボタンを点灯」となっており、ユースケース記述の流れと整合している。

- **分岐の扱い**
  - 「投入金額不足時、BF-1へ戻る」分岐がアクティビティ図には明示されていない（「repeat」構造で表現されているが、明確な「金額不足」判定がない）。
  - **指摘**: 「投入金額不足時、BF-1へ戻る」分岐がアクティビティ図に明示されていない。

---

## UC7 商品を補充する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-4**（補充完了後、必要に応じてシステムに補充内容や在庫数を入力・登録する（自動検知/手動入力）。）
  - アクティビティ図では「補充内容や在庫数の入力/登録を促す」「補充内容入力・確認・登録」としているため、ほぼ対応している。

- **BF-6**（システムまたは管理者は補充日時・担当者などの履歴を記録する。）
  - アクティビティ図では「補充日時・担当者等を記録」としているため、対応している。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **BF-3/BF-4の順序**
  - アクティビティ図では「補充が必要な商品を確認→不足している商品を補充→補充内容や在庫数の入力/登録」となっており、ユースケース記述の流れと整合している。

---

## UC1 商品一覧を表示する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-2**（利用者は自動販売機の前面を通じて、現在購入可能な商品を確認する。）
  - アクティビティ図では「商品一覧画面を確認」としているため、対応している。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- **「自動販売機または操作端末の前に立つ」**
  - アクティビティ図の開始直後に「自動販売機または操作端末の前に立つ」があるが、ユースケース記述には明示的なステップとして存在しない。
  - **指摘**: アクティビティ図要素「自動販売機または操作端末の前に立つ」はユースケース記述のフローIDに対応しない。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- 特に矛盾なし。

---

## UC4 釣銭・返金を受け取る

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-1**（利用者は釣銭レバー（返金レバー）を操作する。）
  - アクティビティ図では「返金・釣銭受け取り操作を待つ」としているが、明示的な「レバー操作」アクションがない。
  - **指摘**: BF-1 の「釣銭レバー操作」がアクティビティ図に明示されていない（要素名: 「返金・釣銭受け取り操作を待つ」）。

- **BF-3**（システムは釣銭・返金ランプ点灯やブザー音等で「お釣り（返金）をお取りください」と案内する。）
  - アクティビティ図では「釣銭・返金の払い出しを案内」としているため、対応している。

- **AF-1-1, AF-1-2**（一定時間釣銭や返金未受領の場合、再度案内→内部保管へ移し管理記録）
  - アクティビティ図には未受領時の再案内や内部保管への遷移が明示されていない。
  - **指摘**: AF-1-1, AF-1-2 の「再案内」「内部保管・管理記録」アクションがアクティビティ図に存在しない。

- **EF-1-2, EF-1-3**（返金不能時の案内、管理会社への連絡先表示、問い合わせ等）
  - アクティビティ図には返金不能時の案内や連絡先表示、問い合わせアクションが明示されていない。
  - **指摘**: EF-1-2, EF-1-3 の「管理会社への連絡先表示」「問い合わせ」アクションがアクティビティ図に存在しない。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- **「商品購入またはキャンセル後、返金・釣銭受け取り操作を待つ」**
  - アクティビティ図の開始直後にあるが、ユースケース記述には明示的なステップとして存在しない。
  - **指摘**: アクティビティ図要素「商品購入またはキャンセル後、返金・釣銭受け取り操作を待つ」はユースケース記述のフローIDに対応しない。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- **AF-1の分岐**
  - アクティビティ図には「一定時間未受領時の再案内や内部保管」分岐がない。
  - **指摘**: AF-1の分岐がアクティビティ図に明示されていない。

---

## UC6 釣銭を補充する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-5**（管理者は釣銭装置の状態を点検し、補充用ドアを閉じて施錠する。）
  - アクティビティ図では「釣銭装置の状態点検・ドアを施錠」としているため、対応している。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- 特に矛盾なし。

---

## UC5 売上金を回収する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-4**（必要に応じて釣銭ボックスに釣銭を補充、または点検する。）
  - アクティビティ図では「釣銭補充」分岐があり、対応している。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- 特に矛盾なし。

---

## UC8 販売商品を変更する

### 1. ユースケース記述のステップがアクティビティ図に存在しない

- **BF-7**（システム（または管理者）は変更日時や担当者・変更内容等を履歴として記録する。）
  - アクティビティ図では「変更日時・担当者・変更内容等を履歴に記録」としているため、対応している。

### 2. アクティビティ図の要素がユースケース記述に対応するステップを持たない

- 特に顕著なものはなし。

### 3. ステップの順序や条件分岐が記述と図で矛盾している

- 特に矛盾なし。

---

# まとめ（主な不整合箇所一覧）

| ユースケース | フローID | アクティビティ図要素名 | 不整合内容 |
|---|---|---|---|
| UC3 お金を投入する | BF-3 | 「購入可能な商品ボタンを点灯」直後 | 金額不足の商品ボタン消灯/選択不可が図にない |
| UC3 お金を投入する | BF-4 | 「商品選択へ進む」 | 他ユースケースへの遷移が図で明示されていない |
| UC3 お金を投入する | EF-1-2 | 「再投入または取引をキャンセル」 | AF-1-1への遷移が図で明示されていない |
| UC3 お金を投入する | なし | 「自動販売機の前に立つ」「待機状態」 | 記述に対応するフローIDがない |
| UC10 機械の状態を確認する | BF-2 | なし | ドアロック解除や点検モード切替が図にない |
| UC10 機械の状態を確認する | BF-5 | なし | 調整・補充・保守等の後続作業への遷移が図にない |
| UC9 故障対応を行う | EF-2-1, EF-2-2 | なし | 機器交換や運用停止・再訪問手配、関連部署報告が図にない |
| UC2 商品を選択し購入する | BF-2 | なし | 決済可否の確認が図にない |
| UC2 商品を選択し購入する | EF-1-2, EF-2-2 | なし | AF-1への遷移が図にない |
| UC2 商品を選択し購入する | なし | 「自動販売機の前に立つ」「待機状態になる」 | 記述に対応するフローIDがない |
| UC2 商品を選択し購入する | 分岐 | なし | 投入金額不足時BF-1へ戻る分岐が図に明示されていない |
| UC1 商品一覧を表示する | なし | 「自動販売機または操作端末の前に立つ」 | 記述に対応するフローIDがない |
| UC4 釣銭・返金を受け取る | BF-1 | 「返金・釣銭受け取り操作を待つ」 | 釣銭レバー操作が図にない |
| UC4 釣銭・返金を受け取る | AF-1-1, AF-1-2 | なし | 再案内、内部保管・管理記録が図にない |
| UC4 釣銭・返金を受け取る | EF-1-2, EF-1-3 | なし | 管理会社連絡先表示、問い合わせが図にない |
| UC4 釣銭・返金を受け取る | なし | 「商品購入またはキャンセル後、返金・釣銭受け取り操作を待つ」 | 記述に対応するフローIDがない |

---

**備考**  
- 「自動販売機の前に立つ」などの開始アクションは多くの図で記述に対応するフローIDがありませんが、前提条件や開始状態の表現として許容範囲です。
- 例外・代替フローの詳細な分岐や他ユースケースへの遷移が図で省略されている場合は、設計意図により省略されている可能性もありますが、厳密な整合性を求める場合は明示的な記載が望ましいです。

---

**ご要望に応じて、個別ユースケースごとの詳細な対応表や修正案も作成可能です。**